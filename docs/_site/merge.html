<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Merging spectra - Astrocook</title> <link rel="shortcut icon" href="/astrocook/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/astrocook/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/astrocook/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/astrocook/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Merging spectra | Astrocook</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Merging spectra" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A thousand recipes to cook a spectrum" /> <meta property="og:description" content="A thousand recipes to cook a spectrum" /> <link rel="canonical" href="http://localhost:4000/astrocook/merge.html" /> <meta property="og:url" content="http://localhost:4000/astrocook/merge.html" /> <meta property="og:site_name" content="Astrocook" /> <script type="application/ld+json"> {"url":"http://localhost:4000/astrocook/merge.html","description":"A thousand recipes to cook a spectrum","headline":"Merging spectra","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/astrocook/" class="site-title lh-tight"> Astrocook </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/astrocook/start.html" class="nav-list-link">Getting started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/astrocook/setup.html" class="nav-list-link">Setup</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/gui.html" class="nav-list-link">Using the GUI</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/workflows.html" class="nav-list-link">Managing workflows</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/astrocook/data.html" class="nav-list-link">Managing data</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/astrocook/structures.html" class="nav-list-link">Data structures</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/graphs.html" class="nav-list-link">Graphs</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/tables.html" class="nav-list-link">Tables</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/other.html" class="nav-list-link">Other tools</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/astrocook/common.html" class="nav-list-link">Common tasks</a><ul class="nav-list "><li class="nav-list-item active"><a href="http://localhost:4000/astrocook/merge.html" class="nav-list-link active">Merging spectra</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/continuum.html" class="nav-list-link">Continuum estimation</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/absorbers.html" class="nav-list-link">Modeling absorbers</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/astrocook/cookbook.html" class="nav-list-link">Cookbooks</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/astrocook/general_cb.html" class="nav-list-link">General cookbook</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/continuum_cb.html" class="nav-list-link">Continuum cookbook</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/absorbers_cb.html" class="nav-list-link">Absorbers cookbook</a></li><li class="nav-list-item "><a href="http://localhost:4000/astrocook/templates_cb.html" class="nav-list-link">Templates cookbook</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/astrocook/about.html" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Astrocook" aria-label="Search Astrocook" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/astrocook/common.html">Common tasks</a></li> <li class="breadcrumb-nav-list-item"><span>Merging spectra</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="merging-spectra"> <a href="#merging-spectra" class="anchor-heading" aria-labelledby="merging-spectra"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Merging spectra </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#rescale-the-spectra" id="markdown-toc-rescale-the-spectra">Rescale the spectra</a></li> <li><a href="#equalize-the-spectra" id="markdown-toc-equalize-the-spectra">Equalize the spectra</a></li> <li><a href="#combine-the-spectra" id="markdown-toc-combine-the-spectra">Combine the spectra</a></li> <li><a href="#rebin-the-combined-spectrum" id="markdown-toc-rebin-the-combined-spectrum">Rebin the combined spectrum</a></li> </ol><hr /> <p><em>Merging</em> is what you do to combine two or more spectra into a single one. In this tutorial, you will learn how to merge two spectra with different wavelength range, like those obtained from different arms of the same instrument (in our case, UVB and VIS arm of VLT X-shooter). The same procedure can be applied to the case of several spectra with the same wavelength range.</p> <p>We assume that the spectra have already been <a href="/astrocook/gui.html#launch-the-gui">loaded</a> in Astrocook:</p> <p><img src="/astrocook/img/merging_start.png" alt="Start" /></p> <h2 id="rescale-the-spectra"> <a href="#rescale-the-spectra" class="anchor-heading" aria-labelledby="rescale-the-spectra"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rescale the spectra </h2> <div class="table-wrapper"><table> <tbody> <tr> <td><strong>The rescaling procedure can be run automatically with <code>$ python ac_gui.py rescale.json</code> in the <code>test/</code> directory.</strong></td> </tr> </tbody> </table></div> <p>The first step is to rescale the spectra to the same flux level, to correct for inaccuracies in flux calibration. To display both spectra in the main graph, select the second one and choose <a href="/astrocook/other.html#visualization"><code class="language-plaintext highlighter-rouge">View &gt; Edit graph elements</code></a>, then modify the text in the box as follows:</p> <p><img src="img/merging_graph_elements.png" width="515" /></p> <p>Clicking on <code class="language-plaintext highlighter-rouge">Apply</code> and zooming into the plot, you will see that in the UVB/VIS superposition region the flux is slightly mismatched:</p> <p><img src="/astrocook/img/merging_mismatch.png" alt="Mismatch" /></p> <p>To rescale the NIR spectra to the VIS one, select it on the main window and choose <a href="/astrocook/general_cb.html#scale-y-axis"><code class="language-plaintext highlighter-rouge">Edit &gt; Scale y axis...</code></a>. In the dialog window, insert a suitable multiplicative factor and click on <code class="language-plaintext highlighter-rouge">Run</code>:</p> <p><img src="img/merging_scale_y_axis.png" width="582" /></p> <p>Selecting both spectra and zooming again, you can check that they are now matching:</p> <p><img src="/astrocook/img/merging_match.png" alt="Match" /></p> <p>You may need to rescale a spectrum several times to find a good matching.</p> <p>❗️ <strong>Please note that the spectra are rescaled in place, without starting a new session. To undo a rescaling, you need to rescale the spectrum again with an inverse factor.</strong></p> <h2 id="equalize-the-spectra"> <a href="#equalize-the-spectra" class="anchor-heading" aria-labelledby="equalize-the-spectra"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Equalize the spectra </h2> <div class="table-wrapper"><table> <tbody> <tr> <td><strong>The equalization procedure can be run automatically with <code>$ python ac_gui.py equalize.json</code> in the <code>test/</code> directory.</strong></td> </tr> </tbody> </table></div> <p>Two spectra can also be rescaled automatically. In the main window, select the two sessions and choose <a href="/astrocook/general_cb.html#equalize-sessions"><code class="language-plaintext highlighter-rouge">Edit &gt; Equalize sessions...</code></a>. You will be asked to define a spectral region to be used as reference:</p> <p><img src="img/merging_equalize_sessions.png" width="582" /></p> <p>On <code class="language-plaintext highlighter-rouge">Run</code>, the recipe will compute the median fluxes of the two spectra in the reference region, and use their ratio to equalize them. By default, the spectrum of the last-selected region is rescaled to the other one.</p> <p>❗️ <strong>Equalization can be performed only on two sessions at a time.</strong></p> <h2 id="combine-the-spectra"> <a href="#combine-the-spectra" class="anchor-heading" aria-labelledby="combine-the-spectra"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Combine the spectra </h2> <div class="table-wrapper"><table> <tbody> <tr> <td><strong>The equalization and combination procedure can be run automatically with <code>$ python ac_gui.py equalize_combine.json</code> in the <code>test/</code> directory.</strong></td> </tr> </tbody> </table></div> <p>Once spectra are rescaled, you need to create a combined session out of the individual ones. In the main window, select both sessions and choose <a href="/astrocook/general_cb.html#combine-sessions"><code class="language-plaintext highlighter-rouge">Edit &gt; Combine sessions...</code></a>. You will be asked for a name for the combination:</p> <p><img src="img/merging_combine_sessions.png" width="582" /></p> <p>The asterisk will be replaced by a concatenation of the selected names (<code class="language-plaintext highlighter-rouge">qso_NIR_qso_VIS</code> in this case). You can alternatively define a different name.</p> <p>On <code class="language-plaintext highlighter-rouge">Run</code>, a new session will be created:</p> <p><img src="/astrocook/img/merging_combined.png" alt="Combined" /></p> <p>The spectrum of this new session contains all the entries of the combined spectra. This means that the pixels of the combined spectrum may overlap with each other (as they keep their original size, defined by <code class="language-plaintext highlighter-rouge">xmin</code> and <code class="language-plaintext highlighter-rouge">xmax</code> in the spectrum table).</p> <p>The same method can be used to combine more than two spectra.</p> <p>❗️ <strong>When sessions are combined, the data structures associated with the spectrum (line lists and system lists) are merged.</strong></p> <h2 id="rebin-the-combined-spectrum"> <a href="#rebin-the-combined-spectrum" class="anchor-heading" aria-labelledby="rebin-the-combined-spectrum"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rebin the combined spectrum </h2> <div class="table-wrapper"><table> <tbody> <tr> <td><strong>The equalization, combination, and rebinning procedure can be run automatically with <code>$ python ac_gui.py equalize_combine_rebin.json</code> in the <code>test/</code> directory.</strong></td> </tr> </tbody> </table></div> <p>It is generally useful to rebin the combined spectrum into a new wavelength grid, to avoid dealing with overlapping pixels. This is done by selecting the combined session in the main window and choosing <a href="/astrocook/general_cb.html#rebin-spectrum"><code class="language-plaintext highlighter-rouge">Recipes &gt; Rebin spectrum...</code></a>. You will be asked to provide a step in <code class="language-plaintext highlighter-rouge">x</code> and a unit of wavelength or velocity for the output spectrum (and optionally a wavelength range):</p> <p><img src="img/merging_rebin_spectrum.png" width="596" /></p> <p>In this case, the spectrum will be rebinned into a grid with a fixed step of 10 km/s. The grid is designed to cover the whole wavelength range of the input spectrum. The rebinned spectrum will appear on the plot after completion:</p> <p><img src="/astrocook/img/merging_rebinned.png" alt="Rebinned" /></p> <p>❗️ <strong>Rebinning may take a long time if the grid is fine and/or the wavelength range is wide.</strong></p> <p>You can rebin any spectrum in any session using the same procedure.</p> <p>❗️ <strong>Please remember that the rebinning procedure interferes with the statistics of your data, as it introduces correlation among adjacent pixels. If accurate flux statistics is required, please avoid rebinning your spectra when it is not absolutely necessary.</strong></p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
